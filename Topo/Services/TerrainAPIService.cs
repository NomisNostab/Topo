using Newtonsoft.Json;
using System.Text;
using Topo.Data;
using Topo.Models.Events;
using Topo.Models.Login;
using Topo.Models.MemberList;
using Topo.Models.OAS;
using Topo.Models.SIA;
using Topo.Models.Milestone;
using Topo.Models.Logbook;

namespace Topo.Services
{

    public interface ITerrainAPIService
    {
        public Task<AuthenticationResultModel?> LoginAsync(string? branch, string? username, string? password);
        public Task<GetUserResultModel?> GetUserAsync();
        public Task<GetProfilesResultModel> GetProfilesAsync();
        public Task RefreshTokenAsync();
        public Task<GetMembersResultModel?> GetMembersAsync(string selectedUnitId);
        public Task<GetEventsResultModel?> GetEventsAsync(string userId, DateTime fromDate, DateTime toDate);
        public Task<GetEventResultModel?> GetEventAsync(string eventId);
        public Task<GetCalendarsResultModel?> GetCalendarsAsync(string userId);
        public Task PutCalendarsAsync(string userId, GetCalendarsResultModel putCalendarsResultModel);
        public Task<GetOASTreeResultsModel?> GetOASTreeAsync(string stream);
        public Task<GetUnitAchievementsResultsModel> GetUnitAchievements(string unit, string stream, string branch, int stage);
        public Task<GetOASTemplateResultModel?> GetOASTemplateAsync(string stream);
        public Task<GetSIAResultsModel> GetSIAResultsForMember(string memberId);
        public Task<GetGroupLifeResultModel> GetGroupLifeForUnit(string unitId);
        public Task<GetMemberLogbookMetricsResultModel> GetMemberLogbookMetrics(string memberId);
        public Task<GetMemberLogbookSummaryResultModel> GetMemberLogbookSummary(string memberId);
        public Task<GetMemberLogbookDetailResultModel> GetMemberLogbookDetail(string memberId, string logbookId);
        public Task RevokeAssumedProfiles();
        public Task AssumeProfile(string memberId);
    }
    public class TerrainAPIService : ITerrainAPIService
    {
        private readonly StorageService _storageService;
        private readonly TopoDBContext _dbContext;
        private readonly IHttpClientFactory _httpClientFactory;
        private readonly string cognitoAddress = "https://cognito-idp.ap-southeast-2.amazonaws.com/";
        private readonly string membersAddress = "https://members.terrain.scouts.com.au/";
        private readonly string eventsAddress = "https://events.terrain.scouts.com.au/";
        private readonly string templatesAddress = "https://templates.terrain.scouts.com.au/";
        private readonly string achievementsAddress = "https://achievements.terrain.scouts.com.au/";
        private readonly string metricsAddress = "https://metrics.terrain.scouts.com.au/";
        private readonly string clientId = "6v98tbc09aqfvh52fml3usas3c";
        private readonly ILogger<TerrainAPIService> _logger;

        public TerrainAPIService(StorageService storageService,
            TopoDBContext topoDBContext,
            IHttpClientFactory httpClientFactory,
            ILogger<TerrainAPIService> logger)
        {
            _storageService = storageService;
            _dbContext = topoDBContext;
            _httpClientFactory = httpClientFactory;
            _logger = logger;
        }

        public async Task<AuthenticationResultModel?> LoginAsync(string? branch, string? username, string? password)
        {
            AuthenticationResultModel authenticationResultModel = new AuthenticationResultModel();

            var initiateAuth = new InitiateAuthModel();
            initiateAuth.ClientMetadata = new ClientMetadata();
            initiateAuth.AuthFlow = "USER_PASSWORD_AUTH";
            initiateAuth.ClientId = clientId;
            initiateAuth.AuthParameters = new AuthParameters();
            initiateAuth.AuthParameters.USERNAME = $"{branch}-{username}";
            initiateAuth.AuthParameters.PASSWORD = password;
            var content = JsonConvert.SerializeObject(initiateAuth);
            var result = await SendRequest(HttpMethod.Post, cognitoAddress, content, "AWSCognitoIdentityProviderService.InitiateAuth");
            var authenticationSuccessResult = JsonConvert.DeserializeObject<AuthenticationSuccessResultModel>(result);
            if (authenticationSuccessResult?.AuthenticationResult != null)
            {
                authenticationResultModel.AuthenticationSuccessResultModel = authenticationSuccessResult;
            }
            else
            {
                var authenticationErrorResultModel = JsonConvert.DeserializeObject<AuthenticationErrorResultModel>(result);
                authenticationResultModel.AuthenticationErrorResultModel = authenticationErrorResultModel;
            }

            return authenticationResultModel;
        }

        public async Task<GetUserResultModel?> GetUserAsync()
        {
            AccessTokenModel accessToken = new AccessTokenModel() { AccessToken = _storageService.AuthenticationResult?.AccessToken };
            var content = JsonConvert.SerializeObject(accessToken);
            var result = await SendRequest(HttpMethod.Post, cognitoAddress, content, "AWSCognitoIdentityProviderService.GetUser");
            var getUserResultModel = JsonConvert.DeserializeObject<GetUserResultModel>(result);

            return getUserResultModel;
        }

        public async Task RefreshTokenAsync()
        {
            if (_storageService.TokenExpiry < DateTime.Now)
            {
                var initiateAuth = new InitiateAuthModel();
                initiateAuth.ClientMetadata = new ClientMetadata();
                initiateAuth.AuthFlow = "REFRESH_TOKEN_AUTH";
                initiateAuth.ClientId = clientId;
                initiateAuth.AuthParameters = new AuthParameters();
                initiateAuth.AuthParameters.REFRESH_TOKEN = _storageService?.AuthenticationResult?.RefreshToken;
                initiateAuth.AuthParameters.DEVICE_KEY = null;
                var content = JsonConvert.SerializeObject(initiateAuth);
                var result = await SendRequest(HttpMethod.Post, cognitoAddress, content, "AWSCognitoIdentityProviderService.InitiateAuth");
                var authenticationResult = JsonConvert.DeserializeObject<AuthenticationSuccessResultModel>(result);
                if (_storageService != null && _storageService.AuthenticationResult != null)
                {
                    _storageService.AuthenticationResult.AccessToken = authenticationResult?.AuthenticationResult?.AccessToken;
                    _storageService.AuthenticationResult.IdToken = authenticationResult?.AuthenticationResult?.IdToken;
                    _storageService.AuthenticationResult.ExpiresIn = authenticationResult?.AuthenticationResult?.ExpiresIn;
                    _storageService.AuthenticationResult.TokenType = authenticationResult?.AuthenticationResult?.TokenType;
                    _storageService.TokenExpiry = DateTime.Now.AddSeconds((authenticationResult?.AuthenticationResult?.ExpiresIn ?? 0) - 60);

                    var authentication = _dbContext.Authentications.FirstOrDefault();
                    if (authentication == null)
                    {
                        authentication = new Data.Models.Authentication();
                        _dbContext.Authentications.Add(authentication);
                    }
                    authentication.AccessToken = authenticationResult.AuthenticationResult.AccessToken;
                    authentication.IdToken = authenticationResult.AuthenticationResult.IdToken;
                    authentication.TokenType = authenticationResult.AuthenticationResult.TokenType;
                    authentication.ExpiresIn = authenticationResult.AuthenticationResult.ExpiresIn;
                    authentication.TokenExpiry = _storageService.TokenExpiry;
                    _dbContext.SaveChanges();
                }
            }
        }

        public async Task<GetProfilesResultModel> GetProfilesAsync()
        {
            await RefreshTokenAsync();
            GetProfilesResultModel? getProfilesResultModel = new GetProfilesResultModel();
            using (var httpClient = new HttpClient())
            {
                HttpRequestMessage httpRequest = new HttpRequestMessage(HttpMethod.Get, membersAddress + "profiles");

                httpRequest.Content = new StringContent("", Encoding.UTF8, "application/x-amz-json-1.1");
                httpRequest.Headers.Add("authorization", _storageService?.AuthenticationResult?.IdToken);
                httpRequest.Headers.Add("accept", "application/json, text/plain, */*");

                var response = await httpClient.SendAsync(httpRequest);
                var responseContent = response.Content.ReadAsStringAsync();
                var result = responseContent.Result;
                getProfilesResultModel = DeserializeObject<GetProfilesResultModel>(result);
                return getProfilesResultModel;
            }
        }

        public async Task<GetMembersResultModel?> GetMembersAsync(string selectedUnitId)
        {
            await RefreshTokenAsync();

            string requestUri = $"{membersAddress}units/{selectedUnitId}/members";
            var result = await SendRequest(HttpMethod.Get, requestUri);
            var getMembersResultModel = DeserializeObject<GetMembersResultModel>(result);

            return getMembersResultModel;
        }

        public async Task<GetEventsResultModel?> GetEventsAsync(string userId, DateTime fromDate, DateTime toDate)
        {
            await RefreshTokenAsync();

            var fromDateString = fromDate.ToString("s");
            var toDateString = toDate.ToString("s");
            string requestUri = $"{eventsAddress}members/{userId}/events?start_datetime={fromDateString}&end_datetime={toDateString}";
            var result = await SendRequest(HttpMethod.Get, requestUri);
            var getEventsResultModel = DeserializeObject<GetEventsResultModel>(result);

            return getEventsResultModel;
        }

        public async Task<GetEventResultModel?> GetEventAsync(string eventId)
        {
            await RefreshTokenAsync();

            string requestUri = $"{eventsAddress}events/{eventId}";
            var result = await SendRequest(HttpMethod.Get, requestUri);
            var getEventResultModel = DeserializeObject<GetEventResultModel>(result);

            return getEventResultModel;
        }

        public async Task<GetCalendarsResultModel?> GetCalendarsAsync(string userId)
        {
            await RefreshTokenAsync();

            string requestUri = $"{eventsAddress}members/{userId}/calendars";
            var result = await SendRequest(HttpMethod.Get, requestUri);
            var getCalendarsResultModel = DeserializeObject<GetCalendarsResultModel>(result);

            return getCalendarsResultModel;
        }

        public async Task PutCalendarsAsync(string userId, GetCalendarsResultModel putCalendarsResultModel)
        {
            await RefreshTokenAsync();

            string requestUri = $"{eventsAddress}members/{userId}/calendars";
            var content = JsonConvert.SerializeObject(putCalendarsResultModel);
            await SendRequest(HttpMethod.Put, requestUri, content);
        }

        public async Task<GetOASTreeResultsModel?> GetOASTreeAsync(string stream)
        {
            await RefreshTokenAsync();

            string requestUri = $"{templatesAddress}oas/{stream}/tree.json";
            var result = await SendRequest(HttpMethod.Get, requestUri);
            var getOASTreeResultsModel = DeserializeObject<GetOASTreeResultsModel>(result);

            return getOASTreeResultsModel;
        }

        public async Task<GetUnitAchievementsResultsModel> GetUnitAchievements(string unit, string stream, string branch, int stage)
        {
            await RefreshTokenAsync();
            string requestUri = $"{achievementsAddress}units/{unit}/achievements?type=outdoor_adventure_skill&stream={stream}&branch={branch}&stage={stage}";
            //var responseContentResult = await SendRequest(HttpMethod.Get, requestUri);
            var responseContentResult = "{\"results\": [{\"id\": \"18f8edfd-17d7-3d65-b946-de8e721f72a7\", \"member_id\": \"74aaa13d-e5fc-3682-98d7-531b73f1bb8b\", \"template\": \"oas/bushwalking/2\", \"version\": 2, \"section\": \"scout\", \"type\": \"outdoor_adventure_skill\", \"answers\": {\"explained_local_vegetation_bushwalking_impact_628c2c\": true, \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifierContact\": \"No contact details\", \"10km_of_total_bushwalked_distance_least_f62488_verifierContact\": \"No contact details\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf\": true, \"whilst_clothing_should_explain_wear_bushwalking_491664_verifierName\": \"Martin McKee\", \"this_stage_short_bushwalks_least_attended_bb6551_verifiedDate\": \"13/09/2021\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifierName\": \"Martin McKee\", \"services_emergency_contact_e9197e_verifiedDate\": \"13/09/2021\", \"this_stage_short_bushwalks_least_attended_bb6551\": true, \"use_compass_find_basic_directions_7255d3_verifierType\": \"member\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifierType\": \"member\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifierContact\": \"No contact details\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifierName\": \"Martin McKee\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifiedDate\": \"13/09/2021\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifierType\": \"member\", \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb\": true, \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifiedDate\": \"13/09/2021\", \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifierName\": \"Martin McKee\", \"this_stage_short_bushwalks_least_attended_bb6551_verifierName\": \"Martin McKee\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b\": true, \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifierContact\": \"No contact details\", \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifierName\": \"Martin McKee\", \"use_compass_find_basic_directions_7255d3_verifierContact\": \"No contact details\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifierType\": \"member\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifierContact\": \"No contact details\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifierContact\": \"No contact details\", \"10km_of_total_bushwalked_distance_least_f62488_verifierName\": \"Martin McKee\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348\": true, \"services_emergency_contact_e9197e_verifierContact\": \"No contact details\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifierContact\": \"No contact details\", \"services_emergency_contact_e9197e\": true, \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifierContact\": \"No contact details\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifiedDate\": \"13/09/2021\", \"10km_of_total_bushwalked_distance_least_f62488\": true, \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifiedDate\": \"13/09/2021\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifierName\": \"Martin McKee\", \"use_compass_find_basic_directions_7255d3_verifierName\": \"Martin McKee\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6\": true, \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifierType\": \"member\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifierName\": \"Martin McKee\", \"10km_of_total_bushwalked_distance_least_f62488_verifiedDate\": \"13/09/2021\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67\": true, \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifierContact\": \"No contact details\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifierName\": \"Martin McKee\", \"services_emergency_contact_e9197e_verifierName\": \"Martin McKee\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifierName\": \"Martin McKee\", \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifiedDate\": \"13/09/2021\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifierType\": \"member\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifierType\": \"member\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifierType\": \"member\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifiedDate\": \"13/09/2021\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifierContact\": \"No contact details\", \"whilst_clothing_should_explain_wear_bushwalking_491664\": true, \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifierName\": \"Martin McKee\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifierContact\": \"No contact details\", \"use_compass_find_basic_directions_7255d3_verifiedDate\": \"13/09/2021\", \"services_emergency_contact_e9197e_verifierType\": \"member\", \"use_compass_find_basic_directions_7255d3\": true, \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifiedDate\": \"13/09/2021\", \"go_show_allowed_start_am_before_bushwalking_where_3863c4\": true, \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifierType\": \"member\", \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifierType\": \"member\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifiedDate\": \"13/09/2021\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea\": true, \"this_stage_short_bushwalks_least_attended_bb6551_verifierType\": \"member\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifiedDate\": \"13/09/2021\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifiedDate\": \"13/09/2021\", \"10km_of_total_bushwalked_distance_least_f62488_verifierType\": \"member\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifierType\": \"member\", \"this_stage_short_bushwalks_least_attended_bb6551_verifierContact\": \"No contact details\"}, \"status\": \"draft_review\", \"status_updated\": \"2021-09-15T09:14:43.115712+00:00\", \"achievement_meta\": {\"stream\": \"bushwalking\", \"branch\": \"bushwalking\", \"stage\": 2}}, {\"id\": \"bd665631-c50f-35b9-9f20-598fb012088b\", \"member_id\": \"d91c508d-dad1-3b22-b5bf-a2b8368da7ec\", \"template\": \"oas/bushwalking/2\", \"version\": 1, \"section\": \"cub\", \"type\": \"outdoor_adventure_skill\", \"status\": \"awarded\", \"status_updated\": \"2020-08-27T13:13:18.034835+00:00\", \"imported\": {\"date_awarded\": \"2020-08-01\", \"awarded_by\": {\"id\": \"fb6b347f-6c73-38d8-a868-ce59747da98f\", \"name\": \"Simon Colmer\"}}, \"achievement_meta\": {\"stream\": \"bushwalking\", \"branch\": \"bushwalking\", \"stage\": 2}}, {\"id\": \"17b4e34d-03e6-318c-b2eb-40f64c1c2b55\", \"member_id\": \"d3c57485-5c1c-3b6e-8fe0-402bf78c7c0c\", \"template\": \"oas/bushwalking/2\", \"version\": 1, \"section\": \"cub\", \"type\": \"outdoor_adventure_skill\", \"status\": \"awarded\", \"status_updated\": \"2020-09-18T00:59:03.906832+00:00\", \"imported\": {\"date_awarded\": \"2020-03-28\", \"awarded_by\": {\"id\": \"d97bd271-1690-38ee-92bf-ed4b5d5cca5b\", \"name\": \"Julie-Anne McKee\"}}, \"achievement_meta\": {\"stream\": \"bushwalking\", \"branch\": \"bushwalking\", \"stage\": 2}}, {\"id\": \"1b8d5a57-5ec0-312c-9b3c-e4e2edb2e1c0\", \"member_id\": \"8711a0a6-346d-375f-967c-810345ec7bcf\", \"template\": \"oas/bushwalking/2\", \"version\": 2, \"section\": \"scout\", \"type\": \"outdoor_adventure_skill\", \"answers\": {\"explained_local_vegetation_bushwalking_impact_628c2c\": true, \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifierContact\": \"JamX Practice camp\", \"10km_of_total_bushwalked_distance_least_f62488_verifierContact\": \"JamX Practice camp\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf\": true, \"whilst_clothing_should_explain_wear_bushwalking_491664_verifierName\": \"Wombat\", \"this_stage_short_bushwalks_least_attended_bb6551_verifiedDate\": \"18/10/2021\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifierName\": \"Wombat\", \"services_emergency_contact_e9197e_verifiedDate\": \"18/10/2021\", \"this_stage_short_bushwalks_least_attended_bb6551\": true, \"logbook_up_to_date\": true, \"use_compass_find_basic_directions_7255d3_verifierType\": \"member\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifierType\": \"member\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifierContact\": \"JamX Practice camp\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifierName\": \"Wombat\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifiedDate\": \"18/10/2021\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifierType\": \"member\", \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb\": true, \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifiedDate\": \"18/10/2021\", \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifierName\": \"Wombat\", \"this_stage_short_bushwalks_least_attended_bb6551_verifierName\": \"Wombat\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b\": true, \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifierContact\": \"JamX Practice camp\", \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifierName\": \"Wombat\", \"use_compass_find_basic_directions_7255d3_verifierContact\": \"JamX Practice camp\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifierType\": \"member\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifierContact\": \"JamX Practice camp\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifierContact\": \"JamX Practice camp\", \"10km_of_total_bushwalked_distance_least_f62488_verifierName\": \"Wombat\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348\": true, \"services_emergency_contact_e9197e_verifierContact\": \"JamX Practice camp\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifierContact\": \"JamX Practice camp\", \"services_emergency_contact_e9197e\": true, \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifierContact\": \"JamX Practice camp\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifiedDate\": \"18/10/2021\", \"10km_of_total_bushwalked_distance_least_f62488\": true, \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifiedDate\": \"18/10/2021\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifierName\": \"Wombat\", \"use_compass_find_basic_directions_7255d3_verifierName\": \"Wombat\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6\": true, \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifierType\": \"member\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifierName\": \"Wombat\", \"10km_of_total_bushwalked_distance_least_f62488_verifiedDate\": \"18/10/2021\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67\": true, \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifierContact\": \"JamX Practice camp\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifierName\": \"Wombat\", \"services_emergency_contact_e9197e_verifierName\": \"Wombat\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifierName\": \"Wombat\", \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifiedDate\": \"18/10/2021\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifierType\": \"member\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifierType\": \"member\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifierType\": \"member\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifiedDate\": \"18/10/2021\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifierContact\": \"JamX Practice camp\", \"whilst_clothing_should_explain_wear_bushwalking_491664\": true, \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifierName\": \"Wombat\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifierContact\": \"JamX Practice camp\", \"use_compass_find_basic_directions_7255d3_verifiedDate\": \"18/10/2021\", \"services_emergency_contact_e9197e_verifierType\": \"member\", \"use_compass_find_basic_directions_7255d3\": true, \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifiedDate\": \"18/10/2021\", \"go_show_allowed_start_am_before_bushwalking_where_3863c4\": true, \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifierType\": \"member\", \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifierType\": \"member\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifiedDate\": \"18/10/2021\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea\": true, \"this_stage_short_bushwalks_least_attended_bb6551_verifierType\": \"member\", \"file_uploader\": [], \"explained_local_vegetation_bushwalking_impact_628c2c_verifiedDate\": \"18/10/2021\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifiedDate\": \"18/10/2021\", \"10km_of_total_bushwalked_distance_least_f62488_verifierType\": \"member\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifierType\": \"member\", \"this_stage_short_bushwalks_least_attended_bb6551_verifierContact\": \"JamX Practice camp\"}, \"status\": \"awarded\", \"status_updated\": \"2021-11-10T10:00:49.238742+00:00\", \"achievement_meta\": {\"stream\": \"bushwalking\", \"branch\": \"bushwalking\", \"stage\": 2}}, {\"id\": \"2e5e2ef6-39e5-3dd6-bcc1-89796309fd49\", \"member_id\": \"914cde18-a065-3837-a819-dc01efecd059\", \"template\": \"oas/bushwalking/2\", \"version\": 2, \"section\": \"scout\", \"type\": \"outdoor_adventure_skill\", \"answers\": {\"explained_local_vegetation_bushwalking_impact_628c2c\": true, \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifierContact\": \"JamX practice camp\", \"10km_of_total_bushwalked_distance_least_f62488_verifierContact\": \"JamX practice camp\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf\": true, \"whilst_clothing_should_explain_wear_bushwalking_491664_verifierName\": \"Baloo\", \"this_stage_short_bushwalks_least_attended_bb6551_verifiedDate\": \"18/10/2021\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifierName\": \"Baloo\", \"services_emergency_contact_e9197e_verifiedDate\": \"18/10/2021\", \"this_stage_short_bushwalks_least_attended_bb6551\": true, \"logbook_up_to_date\": true, \"use_compass_find_basic_directions_7255d3_verifierType\": \"member\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifierType\": \"member\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifierContact\": \"JamX practice camp\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifierName\": \"Baloo\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifiedDate\": \"18/10/2021\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifierType\": \"member\", \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb\": true, \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifiedDate\": \"18/10/2021\", \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifierName\": \"Baloo\", \"this_stage_short_bushwalks_least_attended_bb6551_verifierName\": \"Baloo\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b\": true, \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifierContact\": \"JamX practice camp\", \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifierName\": \"Baloo\", \"use_compass_find_basic_directions_7255d3_verifierContact\": \"JamX practice camp\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifierType\": \"member\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifierContact\": \"JamX practice camp\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifierContact\": \"JamX practice camp\", \"10km_of_total_bushwalked_distance_least_f62488_verifierName\": \"Baloo\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348\": true, \"services_emergency_contact_e9197e_verifierContact\": \"JamX practice camp\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifierContact\": \"JamX practice camp\", \"services_emergency_contact_e9197e\": true, \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifierContact\": \"JamX practice camp\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifiedDate\": \"18/10/2021\", \"10km_of_total_bushwalked_distance_least_f62488\": true, \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifiedDate\": \"18/10/2021\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifierName\": \"Baloo\", \"use_compass_find_basic_directions_7255d3_verifierName\": \"Baloo\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6\": true, \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifierType\": \"member\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifierName\": \"Baloo\", \"10km_of_total_bushwalked_distance_least_f62488_verifiedDate\": \"18/10/2021\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67\": true, \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifierContact\": \"JamX practice camp\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifierName\": \"Baloo\", \"services_emergency_contact_e9197e_verifierName\": \"Baloo\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifierName\": \"Baloo\", \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifiedDate\": \"18/10/2021\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifierType\": \"member\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifierType\": \"member\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifierType\": \"member\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifiedDate\": \"18/10/2021\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifierContact\": \"JamX practice camp\", \"whilst_clothing_should_explain_wear_bushwalking_491664\": true, \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifierName\": \"Baloo\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifierContact\": \"JamX practice camp\", \"use_compass_find_basic_directions_7255d3_verifiedDate\": \"18/10/2021\", \"services_emergency_contact_e9197e_verifierType\": \"member\", \"use_compass_find_basic_directions_7255d3\": true, \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifiedDate\": \"18/10/2021\", \"go_show_allowed_start_am_before_bushwalking_where_3863c4\": true, \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifierType\": \"member\", \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifierType\": \"member\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifiedDate\": \"18/10/2021\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea\": true, \"this_stage_short_bushwalks_least_attended_bb6551_verifierType\": \"member\", \"file_uploader\": [], \"explained_local_vegetation_bushwalking_impact_628c2c_verifiedDate\": \"18/10/2021\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifiedDate\": \"18/10/2021\", \"10km_of_total_bushwalked_distance_least_f62488_verifierType\": \"member\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifierType\": \"member\", \"this_stage_short_bushwalks_least_attended_bb6551_verifierContact\": \"JamX practice camp\"}, \"status\": \"awarded\", \"status_updated\": \"2021-11-10T09:59:24.098656+00:00\", \"achievement_meta\": {\"stream\": \"bushwalking\", \"branch\": \"bushwalking\", \"stage\": 2}}, {\"id\": \"a091d7f0-1bcf-3e19-9eee-ee6398b6c996\", \"member_id\": \"69660ae1-6be2-3430-8feb-4a68c5682809\", \"template\": \"oas/bushwalking/2\", \"version\": 2, \"section\": \"scout\", \"type\": \"outdoor_adventure_skill\", \"answers\": {\"explained_local_vegetation_bushwalking_impact_628c2c\": true, \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifierContact\": \"mckee.clan6@gmail.com\", \"10km_of_total_bushwalked_distance_least_f62488_verifierContact\": \"mckee.clan6@gmail.com\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf\": true, \"whilst_clothing_should_explain_wear_bushwalking_491664_verifierName\": \"Jules McKee\", \"this_stage_short_bushwalks_least_attended_bb6551_verifiedDate\": \"07/10/2021\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifierName\": \"Jules McKee\", \"services_emergency_contact_e9197e_verifiedDate\": \"07/10/2021\", \"this_stage_short_bushwalks_least_attended_bb6551\": true, \"logbook_up_to_date\": true, \"use_compass_find_basic_directions_7255d3_verifierType\": \"member\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifierType\": \"member\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifierContact\": \"mckee.clan6@gmail.com\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifierName\": \"Jules McKee\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifiedDate\": \"07/10/2021\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifierType\": \"member\", \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb\": true, \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifiedDate\": \"07/10/2021\", \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifierName\": \"Jules McKee\", \"this_stage_short_bushwalks_least_attended_bb6551_verifierName\": \"Jules McKee\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b\": true, \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifierContact\": \"mckee.clan6@gmail.com\", \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifierName\": \"Jules McKee\", \"use_compass_find_basic_directions_7255d3_verifierContact\": \"mckee.clan6@gmail.com\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifierType\": \"member\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifierContact\": \"mckee.clan6@gmail.com\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifierContact\": \"mckee.clan6@gmail.com\", \"10km_of_total_bushwalked_distance_least_f62488_verifierName\": \"Jules McKee\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348\": true, \"services_emergency_contact_e9197e_verifierContact\": \"mckee.clan6@gmail.com\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifierContact\": \"mckee.clan6@gmail.com\", \"services_emergency_contact_e9197e\": true, \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifierContact\": \"mckee.clan6@gmail.com\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifiedDate\": \"07/10/2021\", \"10km_of_total_bushwalked_distance_least_f62488\": true, \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifiedDate\": \"07/10/2021\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifierName\": \"Jules McKee\", \"use_compass_find_basic_directions_7255d3_verifierName\": \"Jules McKee\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6\": true, \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifierType\": \"member\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifierName\": \"Jules McKee\", \"10km_of_total_bushwalked_distance_least_f62488_verifiedDate\": \"07/10/2021\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67\": true, \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifierContact\": \"mckee.clan6@gmail.com\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifierName\": \"Jules McKee\", \"services_emergency_contact_e9197e_verifierName\": \"Jules McKee\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifierName\": \"Jules McKee\", \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifiedDate\": \"07/10/2021\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifierType\": \"member\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifierType\": \"member\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifierType\": \"member\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifiedDate\": \"07/10/2021\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifierContact\": \"mckee.clan6@gmail.com\", \"whilst_clothing_should_explain_wear_bushwalking_491664\": true, \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifierName\": \"Jules McKee\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifierContact\": \"mckee.clan6@gmail.com\", \"use_compass_find_basic_directions_7255d3_verifiedDate\": \"07/10/2021\", \"services_emergency_contact_e9197e_verifierType\": \"member\", \"use_compass_find_basic_directions_7255d3\": true, \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifiedDate\": \"07/10/2021\", \"go_show_allowed_start_am_before_bushwalking_where_3863c4\": true, \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifierType\": \"member\", \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifierType\": \"member\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifiedDate\": \"07/10/2021\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea\": true, \"this_stage_short_bushwalks_least_attended_bb6551_verifierType\": \"member\", \"file_uploader\": [], \"explained_local_vegetation_bushwalking_impact_628c2c_verifiedDate\": \"07/10/2021\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifiedDate\": \"07/10/2021\", \"10km_of_total_bushwalked_distance_least_f62488_verifierType\": \"member\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifierType\": \"member\", \"this_stage_short_bushwalks_least_attended_bb6551_verifierContact\": \"mckee.clan6@gmail.com\"}, \"status\": \"awarded\", \"status_updated\": \"2021-10-20T07:59:23.371634+00:00\", \"achievement_meta\": {\"stream\": \"bushwalking\", \"branch\": \"bushwalking\", \"stage\": 2}}, {\"id\": \"322d481c-742f-3970-9543-c3a555db05f4\", \"member_id\": \"c1b5d9ed-69d2-363e-b11e-cc6cc67c07e2\", \"template\": \"oas/bushwalking/2\", \"version\": 1, \"section\": \"cub\", \"type\": \"outdoor_adventure_skill\", \"status\": \"awarded\", \"status_updated\": \"2020-08-13T06:06:56.886919+00:00\", \"imported\": {\"date_awarded\": \"2019-06-11\", \"awarded_by\": {\"id\": \"d97bd271-1690-38ee-92bf-ed4b5d5cca5b\", \"name\": \"Julie-Anne McKee\"}}, \"achievement_meta\": {\"stream\": \"bushwalking\", \"branch\": \"bushwalking\", \"stage\": 2}}, {\"id\": \"2acdea8a-8774-3d95-8f41-7169abe08429\", \"member_id\": \"198ba1d7-58f9-36d7-b601-a803f07a62ea\", \"template\": \"oas/bushwalking/2\", \"version\": 1, \"section\": \"cub\", \"type\": \"outdoor_adventure_skill\", \"status\": \"awarded\", \"status_updated\": \"2020-08-17T01:54:00.955210+00:00\", \"imported\": {\"date_awarded\": \"2018-11-06\", \"awarded_by\": {\"id\": \"d97bd271-1690-38ee-92bf-ed4b5d5cca5b\", \"name\": \"Julie-Anne McKee\"}}, \"achievement_meta\": {\"stream\": \"bushwalking\", \"branch\": \"bushwalking\", \"stage\": 2}}, {\"id\": \"70631143-84c5-3c2a-99ed-be5fa87d40d2\", \"member_id\": \"a3ebb4ab-2ff7-31ef-8586-dca68769e267\", \"template\": \"oas/bushwalking/2\", \"version\": 2, \"section\": \"scout\", \"type\": \"outdoor_adventure_skill\", \"answers\": {\"explained_local_vegetation_bushwalking_impact_628c2c\": true, \"10km_of_total_bushwalked_distance_least_f62488\": true, \"use_compass_find_basic_directions_7255d3_verifierName\": \"Adam Duniam\", \"10km_of_total_bushwalked_distance_least_f62488_verifierContact\": \"No contact details\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf\": true, \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifierName\": \"Adam Duniam\", \"10km_of_total_bushwalked_distance_least_f62488_verifiedDate\": \"11/11/2021\", \"this_stage_short_bushwalks_least_attended_bb6551_verifiedDate\": \"11/11/2021\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifierName\": \"Adam Duniam, Jason Hewlett\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifierName\": \"Matthew Healey, Jason Hewlett, Adam Duniam, Fletcher Duniam\", \"services_emergency_contact_e9197e_verifiedDate\": \"29/11/2021\", \"this_stage_short_bushwalks_least_attended_bb6551\": true, \"use_compass_find_basic_directions_7255d3_verifierType\": \"member\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifierName\": \"Matthew Healey, Jason Hewlett, Adam Duniam, Fletcher Duniam\", \"services_emergency_contact_e9197e_verifierName\": \"Matthew Healey, Jason Hewlett, Adam Duniam, Fletcher Duniam\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifierContact\": \"N/A\", \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifiedDate\": \"11/11/2021\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifierType\": \"Matthew Healey, Jason Hewlett, Adam Duniam, Fletcher Duniam\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifierType\": \"Matthew Healey, Jason Hewlett, Adam Duniam, Fletcher Duniam\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifierType\": \"member\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifierType\": \"Adam Duniam, Jason Hewlett\", \"whilst_clothing_should_explain_wear_bushwalking_491664\": true, \"use_compass_find_basic_directions_7255d3_verifiedDate\": \"11/11/2021\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifiedDate\": \"11/11/2021\", \"this_stage_short_bushwalks_least_attended_bb6551_verifierName\": \"Adam Duniam\", \"services_emergency_contact_e9197e_verifierType\": \"Matthew Healey, Jason Hewlett, Adam Duniam, Fletcher Duniam\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifierContact\": \"N/A\", \"use_compass_find_basic_directions_7255d3\": true, \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifierName\": \"Adam Duniam\", \"go_show_allowed_start_am_before_bushwalking_where_3863c4\": true, \"use_compass_find_basic_directions_7255d3_verifierContact\": \"No contact details\", \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifierType\": \"member\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifiedDate\": \"10/04/2022\", \"this_stage_short_bushwalks_least_attended_bb6551_verifierType\": \"member\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifierContact\": \"No contact details\", \"10km_of_total_bushwalked_distance_least_f62488_verifierName\": \"Adam Duniam\", \"10km_of_total_bushwalked_distance_least_f62488_verifierType\": \"member\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifiedDate\": \"29/11/2021\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifierContact\": \"N/A\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifiedDate\": \"29/11/2021\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348\": true, \"services_emergency_contact_e9197e_verifierContact\": \"N/A\", \"this_stage_short_bushwalks_least_attended_bb6551_verifierContact\": \"No contact details\", \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifierContact\": \"No contact details\", \"services_emergency_contact_e9197e\": true}, \"status\": \"draft_review\", \"status_updated\": \"2022-04-10T01:40:19.637317+00:00\", \"achievement_meta\": {\"stream\": \"bushwalking\", \"branch\": \"bushwalking\", \"stage\": 2}}, {\"id\": \"09803781-540c-3fbf-b333-10b5929348e3\", \"member_id\": \"1bed4792-1c64-3e50-881f-82658c8db063\", \"template\": \"oas/bushwalking/2\", \"version\": 1, \"section\": \"cub\", \"type\": \"outdoor_adventure_skill\", \"status\": \"awarded\", \"status_updated\": \"2020-08-17T06:53:37.803496+00:00\", \"imported\": {\"date_awarded\": \"2020-02-13\", \"awarded_by\": {\"id\": \"d97bd271-1690-38ee-92bf-ed4b5d5cca5b\", \"name\": \"Julie-Anne McKee\"}}, \"achievement_meta\": {\"stream\": \"bushwalking\", \"branch\": \"bushwalking\", \"stage\": 2}}, {\"id\": \"2f1b0d3c-b4e1-3c6b-a27b-e7881ccef616\", \"member_id\": \"145ecce6-c7bd-3cbc-b3cc-b43ee48c0365\", \"template\": \"oas/bushwalking/2\", \"version\": 2, \"section\": \"scout\", \"type\": \"outdoor_adventure_skill\", \"answers\": {\"explained_local_vegetation_bushwalking_impact_628c2c\": true, \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifierContact\": \"JamX practice camp\", \"10km_of_total_bushwalked_distance_least_f62488_verifierContact\": \"JamX practice camp\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf\": true, \"whilst_clothing_should_explain_wear_bushwalking_491664_verifierName\": \"Tex\", \"this_stage_short_bushwalks_least_attended_bb6551_verifiedDate\": \"18/10/2021\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifierName\": \"Tex\", \"services_emergency_contact_e9197e_verifiedDate\": \"18/10/2021\", \"this_stage_short_bushwalks_least_attended_bb6551\": true, \"logbook_up_to_date\": true, \"use_compass_find_basic_directions_7255d3_verifierType\": \"member\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifierType\": \"member\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifierContact\": \"JamX practice camp\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifierName\": \"Tex\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifiedDate\": \"18/10/2021\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifierType\": \"member\", \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb\": true, \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifiedDate\": \"18/10/2021\", \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifierName\": \"Tex\", \"this_stage_short_bushwalks_least_attended_bb6551_verifierName\": \"Tex\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b\": true, \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifierContact\": \"JamX practice camp\", \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifierName\": \"Tex\", \"use_compass_find_basic_directions_7255d3_verifierContact\": \"JamX practice camp\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifierType\": \"member\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifierContact\": \"JamX practice camp\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifierContact\": \"JamX practice camp\", \"10km_of_total_bushwalked_distance_least_f62488_verifierName\": \"Tex\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348\": true, \"services_emergency_contact_e9197e_verifierContact\": \"JamX practice camp\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifierContact\": \"JamX practice camp\", \"services_emergency_contact_e9197e\": true, \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifierContact\": \"JamX practice camp\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifiedDate\": \"18/10/2021\", \"10km_of_total_bushwalked_distance_least_f62488\": true, \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifiedDate\": \"18/10/2021\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifierName\": \"Tex\", \"use_compass_find_basic_directions_7255d3_verifierName\": \"Tex\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6\": true, \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifierType\": \"member\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifierName\": \"Tex\", \"10km_of_total_bushwalked_distance_least_f62488_verifiedDate\": \"18/10/2021\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67\": true, \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifierContact\": \"JamX practice camp\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifierName\": \"Tex\", \"services_emergency_contact_e9197e_verifierName\": \"Tex\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifierName\": \"Tex\", \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifiedDate\": \"18/10/2021\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifierType\": \"member\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifierType\": \"member\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifierType\": \"member\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifiedDate\": \"18/10/2021\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifierContact\": \"JamX practice camp\", \"whilst_clothing_should_explain_wear_bushwalking_491664\": true, \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifierName\": \"Tex\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifierContact\": \"JamX practice camp\", \"use_compass_find_basic_directions_7255d3_verifiedDate\": \"18/10/2021\", \"services_emergency_contact_e9197e_verifierType\": \"member\", \"use_compass_find_basic_directions_7255d3\": true, \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifiedDate\": \"18/10/2021\", \"go_show_allowed_start_am_before_bushwalking_where_3863c4\": true, \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifierType\": \"member\", \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifierType\": \"member\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifiedDate\": \"18/10/2021\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea\": true, \"this_stage_short_bushwalks_least_attended_bb6551_verifierType\": \"member\", \"file_uploader\": [], \"explained_local_vegetation_bushwalking_impact_628c2c_verifiedDate\": \"18/10/2021\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifiedDate\": \"18/10/2021\", \"10km_of_total_bushwalked_distance_least_f62488_verifierType\": \"member\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifierType\": \"member\", \"this_stage_short_bushwalks_least_attended_bb6551_verifierContact\": \"JamX practice camp\"}, \"status\": \"awarded\", \"status_updated\": \"2021-11-10T10:08:02.402469+00:00\", \"achievement_meta\": {\"stream\": \"bushwalking\", \"branch\": \"bushwalking\", \"stage\": 2}}, {\"id\": \"4df1c790-3778-37ed-94f2-0015aa189f1e\", \"member_id\": \"ad628852-7404-3c98-b84f-6b94556d372b\", \"template\": \"oas/bushwalking/2\", \"version\": 1, \"section\": \"scout\", \"type\": \"outdoor_adventure_skill\", \"answers\": {\"explained_local_vegetation_bushwalking_impact_628c2c\": true, \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifierContact\": \"No contact details\", \"10km_of_total_bushwalked_distance_least_f62488_verifierContact\": \"No contact details\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf\": true, \"whilst_clothing_should_explain_wear_bushwalking_491664_verifierName\": \"Simon Colmer\", \"this_stage_short_bushwalks_least_attended_bb6551_verifiedDate\": \"8/1/2020\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifierName\": \"Simon Colmer\", \"services_emergency_contact_e9197e_verifiedDate\": \"8/1/2020\", \"this_stage_short_bushwalks_least_attended_bb6551\": true, \"logbook_up_to_date\": true, \"use_compass_find_basic_directions_7255d3_verifierType\": \"member\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifierType\": \"member\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifierContact\": \"No contact details\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifierName\": \"Simon Colmer\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifiedDate\": \"8/1/2020\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifierType\": \"member\", \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb\": true, \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifiedDate\": \"8/1/2020\", \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifierName\": \"Simon Colmer\", \"this_stage_short_bushwalks_least_attended_bb6551_verifierName\": \"Simon Colmer\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b\": true, \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifierContact\": \"No contact details\", \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifierName\": \"Simon Colmer\", \"use_compass_find_basic_directions_7255d3_verifierContact\": \"No contact details\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifierType\": \"member\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifierContact\": \"No contact details\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifierContact\": \"No contact details\", \"10km_of_total_bushwalked_distance_least_f62488_verifierName\": \"Simon Colmer\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348\": true, \"services_emergency_contact_e9197e_verifierContact\": \"No contact details\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifierContact\": \"No contact details\", \"services_emergency_contact_e9197e\": true, \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifierContact\": \"No contact details\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifiedDate\": \"8/1/2020\", \"10km_of_total_bushwalked_distance_least_f62488\": true, \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifiedDate\": \"8/1/2020\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifierName\": \"Simon Colmer\", \"use_compass_find_basic_directions_7255d3_verifierName\": \"Simon Colmer\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6\": true, \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifierType\": \"member\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifierName\": \"Simon Colmer\", \"10km_of_total_bushwalked_distance_least_f62488_verifiedDate\": \"8/1/2020\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67\": true, \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifierContact\": \"No contact details\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifierName\": \"Simon Colmer\", \"services_emergency_contact_e9197e_verifierName\": \"Simon Colmer\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifierName\": \"Simon Colmer\", \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifiedDate\": \"8/1/2020\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifierType\": \"member\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifierType\": \"member\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifierType\": \"member\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifiedDate\": \"8/1/2020\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifierContact\": \"No contact details\", \"whilst_clothing_should_explain_wear_bushwalking_491664\": true, \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifierName\": \"Simon Colmer\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifierContact\": \"No contact details\", \"use_compass_find_basic_directions_7255d3_verifiedDate\": \"8/1/2020\", \"services_emergency_contact_e9197e_verifierType\": \"member\", \"use_compass_find_basic_directions_7255d3\": true, \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifiedDate\": \"8/1/2020\", \"go_show_allowed_start_am_before_bushwalking_where_3863c4\": true, \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifierType\": \"member\", \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifierType\": \"member\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifiedDate\": \"8/1/2020\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea\": true, \"this_stage_short_bushwalks_least_attended_bb6551_verifierType\": \"member\", \"file_uploader\": [], \"explained_local_vegetation_bushwalking_impact_628c2c_verifiedDate\": \"8/1/2020\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifiedDate\": \"8/1/2020\", \"10km_of_total_bushwalked_distance_least_f62488_verifierType\": \"member\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifierType\": \"member\", \"this_stage_short_bushwalks_least_attended_bb6551_verifierContact\": \"No contact details\"}, \"status\": \"awarded\", \"status_updated\": \"2021-06-21T07:49:51.653152+00:00\", \"achievement_meta\": {\"stream\": \"bushwalking\", \"branch\": \"bushwalking\", \"stage\": 2}}, {\"id\": \"60dfa95e-9079-3ab5-a7ed-967fd832bc12\", \"member_id\": \"81cfd275-ac70-3a4b-84d7-9a8a71ac8c78\", \"template\": \"oas/bushwalking/2\", \"version\": 1, \"section\": \"cub\", \"type\": \"outdoor_adventure_skill\", \"status\": \"awarded\", \"status_updated\": \"2020-08-17T11:27:35.704696+00:00\", \"imported\": {\"date_awarded\": \"2020-04-07\", \"awarded_by\": {\"id\": \"d97bd271-1690-38ee-92bf-ed4b5d5cca5b\", \"name\": \"Julie-Anne McKee\"}}, \"achievement_meta\": {\"stream\": \"bushwalking\", \"branch\": \"bushwalking\", \"stage\": 2}}, {\"id\": \"09da9601-832b-3f79-be4f-510523340894\", \"member_id\": \"f9b82305-8137-310b-a1ac-f9a91738e757\", \"template\": \"oas/bushwalking/2\", \"version\": 1, \"section\": \"scout\", \"type\": \"outdoor_adventure_skill\", \"answers\": {\"logbook_up_to_date\": true, \"file_uploader\": [\"cHJvZC1maWxldXBsb2FkLXNlcnZpY2UtdXBsb2Fkc2J1Y2tldC0xY3p1dWh2OXVvNG94fmFjaGlldmVtZW50cy9mOWI4MjMwNS04MTM3LTMxMGItYTFhYy1mOWE5MTczOGU3NTcvYjA3MmMzYmYtNzIwZS00MTFiLWIyZjAtNDU2NTM2ODMwNDYxLmpwZw==\"]}, \"status\": \"awarded\", \"status_updated\": \"2020-09-17T01:46:04.999293+00:00\", \"uploads\": [{\"id\": \"cHJvZC1maWxldXBsb2FkLXNlcnZpY2UtdXBsb2Fkc2J1Y2tldC0xY3p1dWh2OXVvNG94fmFjaGlldmVtZW50cy9mOWI4MjMwNS04MTM3LTMxMGItYTFhYy1mOWE5MTczOGU3NTcvYjA3MmMzYmYtNzIwZS00MTFiLWIyZjAtNDU2NTM2ODMwNDYxLmpwZw==\", \"filename\": \"15996335393114501372255925959660.jpg\", \"bucket\": \"prod-fileupload-service-uploadsbucket-1czuuhv9uo4ox\", \"key\": \"achievements/f9b82305-8137-310b-a1ac-f9a91738e757/b072c3bf-720e-411b-b2f0-456536830461.jpg\", \"url\": \"https://prod-fileupload-service-uploadsbucket-1czuuhv9uo4ox.s3.amazonaws.com/achievements/f9b82305-8137-310b-a1ac-f9a91738e757/b072c3bf-720e-411b-b2f0-456536830461.jpg?response-content-disposition=attachment%3B%20filename%3D15996335393114501372255925959660.jpg&AWSAccessKeyId=ASIA5EWNYVKF47O5GCWY&Signature=XCBGNhXbhJHJWNeWZefb7bDZUsw%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEEwaDmFwLXNvdXRoZWFzdC0yIkYwRAIgOL%2B28CUfSy1m5kFekNdQ8Ufnb8wF9JNYyVljqNvntzYCICmI4amUydB6v%2BQf7jyVata6GzSxLrWYTZR6hZ8vK%2FsPKsMCCCUQAhoMOTAzNDQ4NDA2NjY3Igx5Wl7LDhyGzDGHPE8qoAIlaus3Patoueb06jepY2n0MtWK42EekogTZ9I%2B1%2FyGkuFtd%2BX3Id69pCRjsPJwz%2FDY09aeEw3lRvUmVsqsONisDdZBXOXd2p1zVFUdzGAobS29WPQwmDejstVHgkUJLwVnz9rE5gpYod8PFkvvWycNjLmy%2F5wBzk1KrU36RMq8gekMDKr9vB2TQmtp6p2tb6p6FYUIb9WZYB%2Bol%2B7WE0MBL631nxyGPyM87xV%2Fai%2Bi2l%2BYdmoWFURxG61mJQeUyGS5nc%2FGZaE8uB3L%2FibR%2FS2WTec4ba9fBKaNZxLCuuig3ebghJcNbLdmHOAvJkWnYOoRF%2FJS3CcG046KijsM%2FriKgToeJjXWyz2Xuc3DOLrPWvtJGflDrc%2Fxn1EeL9kVyjgw7vLskwY6mwG%2FJlbhri4JFqeqB8voU3bfKxJ1P3AsJZ%2B0UGGBL3PPqrAmelUwEAz%2B1auZcONE27H0XchFOjPIOCqczYTue7%2FmKBwwKh59quT2OYLXD0hsOLQPMhIxNLutrJyC6eXqYXs%2FNA%2FR2DPd7SrSqZcm3pG3TOZ4Sp8W5vRs1KZcw4POJbVzX85sxGCbem6T1h3xTbZtLh8V6Dqevv5TUA%3D%3D&Expires=1652246558\", \"uploaded_on\": \"2020-09-09T06:39:13.750000+00:00\"}], \"achievement_meta\": {\"stream\": \"bushwalking\", \"branch\": \"bushwalking\", \"stage\": 2}}, {\"id\": \"e193bc64-e95d-3921-9285-12e74a3577ee\", \"member_id\": \"a7991b3d-153c-3618-92e3-33d6ece018be\", \"template\": \"oas/bushwalking/2\", \"version\": 1, \"section\": \"cub\", \"type\": \"outdoor_adventure_skill\", \"answers\": {\"explained_local_vegetation_bushwalking_impact_628c2c\": true, \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifierContact\": \"No contact details\", \"10km_of_total_bushwalked_distance_least_f62488_verifierContact\": \"No contact details\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf\": true, \"whilst_clothing_should_explain_wear_bushwalking_491664_verifierName\": \"Simon Colmer\", \"this_stage_short_bushwalks_least_attended_bb6551_verifiedDate\": \"8/1/2020\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifierName\": \"Simon Colmer\", \"services_emergency_contact_e9197e_verifiedDate\": \"8/1/2020\", \"this_stage_short_bushwalks_least_attended_bb6551\": true, \"use_compass_find_basic_directions_7255d3_verifierType\": \"member\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifierType\": \"member\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifierContact\": \"No contact details\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifierName\": \"Simon Colmer\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifiedDate\": \"8/1/2020\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifierType\": \"member\", \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb\": true, \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifiedDate\": \"8/1/2020\", \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifierName\": \"Simon Colmer\", \"this_stage_short_bushwalks_least_attended_bb6551_verifierName\": \"Simon Colmer\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b\": true, \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifierContact\": \"No contact details\", \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifierName\": \"Simon Colmer\", \"use_compass_find_basic_directions_7255d3_verifierContact\": \"No contact details\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifierType\": \"member\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifierContact\": \"No contact details\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifierContact\": \"No contact details\", \"10km_of_total_bushwalked_distance_least_f62488_verifierName\": \"Simon Colmer\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348\": true, \"services_emergency_contact_e9197e_verifierContact\": \"No contact details\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifierContact\": \"No contact details\", \"services_emergency_contact_e9197e\": true, \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifierContact\": \"No contact details\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifiedDate\": \"8/1/2020\", \"10km_of_total_bushwalked_distance_least_f62488\": true, \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifiedDate\": \"8/1/2020\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifierName\": \"Simon Colmer\", \"use_compass_find_basic_directions_7255d3_verifierName\": \"Simon Colmer\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6\": true, \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifierType\": \"member\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifierName\": \"Simon Colmer\", \"10km_of_total_bushwalked_distance_least_f62488_verifiedDate\": \"8/1/2020\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67\": true, \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifierContact\": \"No contact details\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifierName\": \"Simon Colmer\", \"services_emergency_contact_e9197e_verifierName\": \"Simon Colmer\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifierName\": \"Simon Colmer\", \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifiedDate\": \"8/1/2020\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifierType\": \"member\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifierType\": \"member\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifierType\": \"member\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifiedDate\": \"8/1/2020\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifierContact\": \"No contact details\", \"whilst_clothing_should_explain_wear_bushwalking_491664\": true, \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifierName\": \"Simon Colmer\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifierContact\": \"No contact details\", \"use_compass_find_basic_directions_7255d3_verifiedDate\": \"8/1/2020\", \"services_emergency_contact_e9197e_verifierType\": \"member\", \"use_compass_find_basic_directions_7255d3\": true, \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifiedDate\": \"8/1/2020\", \"go_show_allowed_start_am_before_bushwalking_where_3863c4\": true, \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifierType\": \"member\", \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifierType\": \"member\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifiedDate\": \"8/1/2020\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea\": true, \"this_stage_short_bushwalks_least_attended_bb6551_verifierType\": \"member\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifiedDate\": \"8/1/2020\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifiedDate\": \"8/1/2020\", \"10km_of_total_bushwalked_distance_least_f62488_verifierType\": \"member\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifierType\": \"member\", \"this_stage_short_bushwalks_least_attended_bb6551_verifierContact\": \"No contact details\"}, \"status\": \"awarded\", \"status_updated\": \"2020-08-27T12:52:25.469336+00:00\", \"achievement_meta\": {\"stream\": \"bushwalking\", \"branch\": \"bushwalking\", \"stage\": 2}}, {\"id\": \"81a4bc79-f5eb-3a0e-9cf7-0fcd9e3932c5\", \"member_id\": \"f50c14d6-e2eb-3011-b78e-950cd7ba02d5\", \"template\": \"oas/bushwalking/2\", \"version\": 2, \"section\": \"scout\", \"type\": \"outdoor_adventure_skill\", \"answers\": {\"explained_local_vegetation_bushwalking_impact_628c2c\": true, \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifierContact\": \"JamX practice camp\", \"10km_of_total_bushwalked_distance_least_f62488_verifierContact\": \"JamX practice camp\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf\": true, \"whilst_clothing_should_explain_wear_bushwalking_491664_verifierName\": \"wombat\", \"this_stage_short_bushwalks_least_attended_bb6551_verifiedDate\": \"18/10/2021\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifierName\": \"wombat\", \"services_emergency_contact_e9197e_verifiedDate\": \"18/10/2021\", \"this_stage_short_bushwalks_least_attended_bb6551\": true, \"logbook_up_to_date\": true, \"use_compass_find_basic_directions_7255d3_verifierType\": \"member\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifierType\": \"member\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifierContact\": \"JamX practice camp\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifierName\": \"wombat\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifiedDate\": \"18/10/2021\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifierType\": \"member\", \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb\": true, \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifiedDate\": \"18/10/2021\", \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifierName\": \"wombat\", \"this_stage_short_bushwalks_least_attended_bb6551_verifierName\": \"wombat\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b\": true, \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifierContact\": \"JamX practice camp\", \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifierName\": \"wombat\", \"use_compass_find_basic_directions_7255d3_verifierContact\": \"JamX practice camp\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifierType\": \"member\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifierContact\": \"JamX practice camp\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifierContact\": \"JamX practice camp\", \"10km_of_total_bushwalked_distance_least_f62488_verifierName\": \"wombat\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348\": true, \"services_emergency_contact_e9197e_verifierContact\": \"JamX practice camp\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifierContact\": \"JamX practice camp\", \"services_emergency_contact_e9197e\": true, \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifierContact\": \"JamX practice camp\", \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifiedDate\": \"18/10/2021\", \"10km_of_total_bushwalked_distance_least_f62488\": true, \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifiedDate\": \"18/10/2021\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifierName\": \"wombat\", \"use_compass_find_basic_directions_7255d3_verifierName\": \"wombat\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6\": true, \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifierType\": \"member\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifierName\": \"wombat\", \"10km_of_total_bushwalked_distance_least_f62488_verifiedDate\": \"18/10/2021\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67\": true, \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifierContact\": \"JamX practice camp\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifierName\": \"wombat\", \"services_emergency_contact_e9197e_verifierName\": \"wombat\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifierName\": \"wombat\", \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifiedDate\": \"18/10/2021\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifierType\": \"member\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifierType\": \"member\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifierType\": \"member\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifiedDate\": \"18/10/2021\", \"list_draw_bushwalk_all_equipment_of_bring_essential_bb6a67_verifierContact\": \"JamX practice camp\", \"whilst_clothing_should_explain_wear_bushwalking_491664\": true, \"learnt_playing_improved_talk_navigational_enjoyed_game_b64c8b_verifierName\": \"wombat\", \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifierContact\": \"JamX practice camp\", \"use_compass_find_basic_directions_7255d3_verifiedDate\": \"18/10/2021\", \"services_emergency_contact_e9197e_verifierType\": \"member\", \"use_compass_find_basic_directions_7255d3\": true, \"picture_list_leaders_equipment_of_reviewed_essential_patrol_f0e7d6_verifiedDate\": \"18/10/2021\", \"go_show_allowed_start_am_before_bushwalking_where_3863c4\": true, \"go_show_allowed_start_am_before_bushwalking_where_3863c4_verifierType\": \"member\", \"learnt_talked_improved_from_bushwalks_least_enjoyed_4241cb_verifierType\": \"member\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifiedDate\": \"18/10/2021\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea\": true, \"this_stage_short_bushwalks_least_attended_bb6551_verifierType\": \"member\", \"file_uploader\": [], \"explained_local_vegetation_bushwalking_impact_628c2c_verifiedDate\": \"18/10/2021\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifiedDate\": \"18/10/2021\", \"10km_of_total_bushwalked_distance_least_f62488_verifierType\": \"member\", \"precautions_safety_bushwalk_take_should_out_discuss_before_59c0ea_verifierType\": \"member\", \"this_stage_short_bushwalks_least_attended_bb6551_verifierContact\": \"JamX practice camp\"}, \"status\": \"awarded\", \"status_updated\": \"2021-10-20T07:44:40.329390+00:00\", \"achievement_meta\": {\"stream\": \"bushwalking\", \"branch\": \"bushwalking\", \"stage\": 2}}, {\"id\": \"169d926d-36ed-3c19-af90-35fcdb2667f4\", \"member_id\": \"0baf52b5-4b60-35ad-ac15-3e3a00d26bc8\", \"template\": \"oas/bushwalking/2\", \"version\": 1, \"section\": \"cub\", \"type\": \"outdoor_adventure_skill\", \"status\": \"awarded\", \"status_updated\": \"2020-08-17T11:38:12.410644+00:00\", \"imported\": {\"date_awarded\": \"2019-05-17\", \"awarded_by\": {\"id\": \"d97bd271-1690-38ee-92bf-ed4b5d5cca5b\", \"name\": \"Julie-Anne McKee\"}}, \"achievement_meta\": {\"stream\": \"bushwalking\", \"branch\": \"bushwalking\", \"stage\": 2}}, {\"id\": \"706d5cdd-81f2-3b4b-8ac6-83deb54dcf7d\", \"member_id\": \"35c45d3d-3dfe-32a6-9f21-bfa6cd1cec8d\", \"template\": \"oas/bushwalking/2\", \"version\": 2, \"section\": \"scout\", \"type\": \"outdoor_adventure_skill\", \"answers\": {\"explained_local_vegetation_bushwalking_impact_628c2c\": true, \"10km_of_total_bushwalked_distance_least_f62488\": true, \"use_compass_find_basic_directions_7255d3_verifierName\": \"Adam Duniam, Jason Hewlett\", \"10km_of_total_bushwalked_distance_least_f62488_verifierContact\": \"N/A\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf\": true, \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifierName\": \"Adam Duniam\", \"10km_of_total_bushwalked_distance_least_f62488_verifiedDate\": \"10/04/2022\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifierName\": \"Adam Duniam, Jason Hewlett\", \"this_stage_short_bushwalks_least_attended_bb6551_verifiedDate\": \"10/04/2022\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifierName\": \"Adam Duniam, Jason Hewlett\", \"services_emergency_contact_e9197e_verifiedDate\": \"10/04/2022\", \"this_stage_short_bushwalks_least_attended_bb6551\": true, \"use_compass_find_basic_directions_7255d3_verifierType\": \"Adam Duniam, Jason Hewlett\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifierName\": \"Adam Duniam, Jason Hewlett\", \"services_emergency_contact_e9197e_verifierName\": \"Adam Duniam, Jason Hewlett\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifierContact\": \"N/A\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifierType\": \"Adam Duniam, Jason Hewlett\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifierType\": \"Adam Duniam, Jason Hewlett\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifierType\": \"member\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifierType\": \"Adam Duniam, Jason Hewlett\", \"whilst_clothing_should_explain_wear_bushwalking_491664\": true, \"use_compass_find_basic_directions_7255d3_verifiedDate\": \"10/04/2022\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifiedDate\": \"11/11/2021\", \"this_stage_short_bushwalks_least_attended_bb6551_verifierName\": \"Adam Duniam, Jason Hewlett\", \"services_emergency_contact_e9197e_verifierType\": \"Adam Duniam, Jason Hewlett\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifierContact\": \"N/A\", \"use_compass_find_basic_directions_7255d3\": true, \"use_compass_find_basic_directions_7255d3_verifierContact\": \"N/A\", \"whilst_clothing_should_explain_wear_bushwalking_491664_verifiedDate\": \"10/04/2022\", \"this_stage_short_bushwalks_least_attended_bb6551_verifierType\": \"Adam Duniam, Jason Hewlett\", \"while_myself_outdoors_exposed_sun_protect_d8fdcf_verifierContact\": \"No contact details\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifiedDate\": \"10/04/2022\", \"explained_local_vegetation_bushwalking_impact_628c2c_verifierContact\": \"N/A\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348_verifiedDate\": \"10/04/2022\", \"10km_of_total_bushwalked_distance_least_f62488_verifierName\": \"Adam Duniam, Jason Hewlett\", \"10km_of_total_bushwalked_distance_least_f62488_verifierType\": \"Adam Duniam, Jason Hewlett\", \"discussed_action_take_should_appropriate_accident_of_emergency_49b348\": true, \"services_emergency_contact_e9197e_verifierContact\": \"N/A\", \"this_stage_short_bushwalks_least_attended_bb6551_verifierContact\": \"N/A\", \"services_emergency_contact_e9197e\": true}, \"status\": \"draft_review\", \"status_updated\": \"2022-04-10T01:40:19.290680+00:00\", \"achievement_meta\": {\"stream\": \"bushwalking\", \"branch\": \"bushwalking\", \"stage\": 2}}]}";

            // Remove uploaded files from response before deserialising
            var fileUploaderStart = responseContentResult.IndexOf("\"file_uploader\":");
            while (fileUploaderStart > 0)
            {
                var padding = 1;
                var fileUploaderEnd = responseContentResult.IndexOf("]", fileUploaderStart);
                var fileUploaderEndNextChar = responseContentResult.Substring(fileUploaderEnd, 2);
                if (fileUploaderEndNextChar == "],")
                    padding = 2;
                var fileUploader = responseContentResult.Substring(fileUploaderStart, fileUploaderEnd - fileUploaderStart + padding);
                responseContentResult = responseContentResult.Replace(fileUploader, "");
                fileUploaderStart = responseContentResult.IndexOf("\"file_uploader\":", fileUploaderStart);
            }
            var getUnitAchievementsResultsModel = DeserializeObject<GetUnitAchievementsResultsModel>(responseContentResult);

            return getUnitAchievementsResultsModel ?? new GetUnitAchievementsResultsModel();
        }

        public async Task<GetOASTemplateResultModel?> GetOASTemplateAsync(string stream)
        {
            await RefreshTokenAsync();

            string requestUri = $"{templatesAddress}{stream}/latest.json";
            var result = await SendRequest(HttpMethod.Get, requestUri);
            var getOASTemplateResultModel = DeserializeObject<GetOASTemplateResultModel>(result);

            return getOASTemplateResultModel;
        }

        public async Task<GetSIAResultsModel> GetSIAResultsForMember(string memberId)
        {
            await RefreshTokenAsync();

            string requestUri = $"{achievementsAddress}members/{memberId}/achievements?type=special_interest_area";
            var result = await SendRequest(HttpMethod.Get, requestUri);
            var getSIAResultsModel = DeserializeObject<GetSIAResultsModel>(result);

            return getSIAResultsModel ?? new GetSIAResultsModel();
        }

        public async Task<GetGroupLifeResultModel> GetGroupLifeForUnit(string unitId)
        {
            await RefreshTokenAsync();

            var requestUri = $"{metricsAddress}units/{unitId}/members?limit=999";
            var result = await SendRequest(HttpMethod.Get, requestUri);
            var getGroupLifeResultModel = DeserializeObject<GetGroupLifeResultModel>(result);

            return getGroupLifeResultModel ?? new GetGroupLifeResultModel();
        }

        public async Task<GetMemberLogbookMetricsResultModel> GetMemberLogbookMetrics(string memberId)
        {
            await RefreshTokenAsync();

            var requestUri = $"{achievementsAddress}members/{memberId}/logbook-metrics";
            var result = await SendRequest(HttpMethod.Get, requestUri);
            var getMemberLogbookMetrics = DeserializeObject<GetMemberLogbookMetricsResultModel>(result);

            return getMemberLogbookMetrics ?? new GetMemberLogbookMetricsResultModel();
        }
        public async Task<GetMemberLogbookSummaryResultModel> GetMemberLogbookSummary(string memberId)
        {
            await RefreshTokenAsync();

            var requestUri = $"{achievementsAddress}members/{memberId}/logbook";
            var result = await SendRequest(HttpMethod.Get, requestUri);
            var getMemberLogbookSummary = DeserializeObject<GetMemberLogbookSummaryResultModel>(result);

            return getMemberLogbookSummary ?? new GetMemberLogbookSummaryResultModel();
        }

        public async Task<GetMemberLogbookDetailResultModel> GetMemberLogbookDetail(string memberId, string logbookId)
        {
            await RefreshTokenAsync();

            var requestUri = $"{achievementsAddress}members/{memberId}/logbook/{logbookId}";
            var result = await SendRequest(HttpMethod.Get, requestUri);
            var getMemberLogbookDetail = DeserializeObject<GetMemberLogbookDetailResultModel>(result);

            return getMemberLogbookDetail ?? new GetMemberLogbookDetailResultModel();
        }

        public async Task RevokeAssumedProfiles()
        {
            await RefreshTokenAsync();

            var requestUri = $"{membersAddress}revoke-assumed-profiles";
            var result = await SendRequest(HttpMethod.Post, requestUri);
        }

        public async Task AssumeProfile(string memberId)
        {
            await RefreshTokenAsync();

            var requestUri = $"{membersAddress}members/{memberId}/assume-profiles";
            var result = await SendRequest(HttpMethod.Post, requestUri);
        }

        private async Task<string> SendRequest(HttpMethod httpMethod, string requestUri, string content = "", string xAmzTargetHeader = "")
        {
            var httpClient = _httpClientFactory.CreateClient();
            HttpRequestMessage httpRequest = new HttpRequestMessage(httpMethod, requestUri);
            httpRequest.Content = new StringContent(content, Encoding.UTF8, "application/x-amz-json-1.1");
            if (string.IsNullOrEmpty(xAmzTargetHeader))
                httpRequest.Headers.Add("authorization", _storageService?.AuthenticationResult?.IdToken);
            else
                httpRequest.Headers.Add("X-Amz-Target", xAmzTargetHeader);
            httpRequest.Headers.Add("accept", "application/json, text/plain, */*");
            httpRequest.Headers.Add("X-Amz-User-Agent", "aws-amplify/0.1.x js");

            var response = await httpClient.SendAsync(httpRequest);
            var responseContent = response.Content.ReadAsStringAsync();
            var result = responseContent.Result;
            if (string.IsNullOrEmpty(xAmzTargetHeader)) // Dont log authorisation requests
            {
                _logger.LogInformation($"Request: {requestUri}");
                _logger.LogInformation($"Response: {result}");
            }
            return result;
        }

        private T DeserializeObject<T>(string result)
        {
            try
            {
                return JsonConvert.DeserializeObject<T>(result);
            }
            catch (Exception ex)
            {
                _logger.LogError($"Error deserialising: {typeof(T)}");
                _logger.LogError($"String being processed: {result}");
                _logger.LogError($"Exception message: {ex.Message}");
            }
            return JsonConvert.DeserializeObject<T>("");
        }
    }
}
