using Newtonsoft.Json;
using Topo.Models.ReportGeneration;
using TopoReportFunction;

namespace TopoReportFunctionTest
{
    [TestClass]
    public class MemberList
    {
        private ReportGenerationRequest _reportGenerationRequest;
        private Function _function;

        [TestInitialize]
        public void SetUp()
        {
            _function = new Function();
            _reportGenerationRequest = new ReportGenerationRequest()
            {
                ReportType = ReportType.MemberList,
                GroupName = "Epping Scout Group",
                Section = "scout",
                UnitName = "Scout Unit",
                OutputType = OutputType.PDF,
                ReportData = "[{\"id\":\"f96da6cf-0a66-303d-94bb-66366dc0ca4a\",\"member_number\":\"1107288\",\"first_name\":\"Alexander\",\"last_name\":\"Holowinski\",\"status\":\"active\",\"date_of_birth\":\"2008-08-13T00:00:00\",\"age\":\"14y 2m\",\"unit_council\":true,\"patrol_name\":\"Tassie Tigers\",\"patrol_duty\":\"PL\",\"patrol_order\":1,\"isAdultLeader\":0,\"selected\":false},{\"id\":\"d4bf9481-ee31-3a51-8c5c-ffa8018b7682\",\"member_number\":\"1159894\",\"first_name\":\"Amelia\",\"last_name\":\"Chung\",\"status\":\"active\",\"date_of_birth\":\"2010-03-08T00:00:00\",\"age\":\"12y 7m\",\"unit_council\":false,\"patrol_name\":\"Drop Bear\",\"patrol_duty\":\"\",\"patrol_order\":3,\"isAdultLeader\":0,\"selected\":false},{\"id\":\"4ca98009-d4f0-3f04-a9ea-6907d17fe99f\",\"member_number\":\"1131282\",\"first_name\":\"Annabella\",\"last_name\":\"Ronfeldt\",\"status\":\"active\",\"date_of_birth\":\"2009-06-16T00:00:00\",\"age\":\"13y 4m\",\"unit_council\":true,\"patrol_name\":\"Drop Bear\",\"patrol_duty\":\"APL\",\"patrol_order\":2,\"isAdultLeader\":0,\"selected\":false},{\"id\":\"ba75e5a4-9e57-3cf5-ad40-2e927935622c\",\"member_number\":\"1105699\",\"first_name\":\"Bethany\",\"last_name\":\"Wong\",\"status\":\"active\",\"date_of_birth\":\"2009-02-06T00:00:00\",\"age\":\"13y 9m\",\"unit_council\":false,\"patrol_name\":\"Lyrebird\",\"patrol_duty\":\"\",\"patrol_order\":3,\"isAdultLeader\":0,\"selected\":false},{\"id\":\"97aaa9bb-2943-3e24-8067-8f1b14df48cd\",\"member_number\":\"1126207\",\"first_name\":\"Cathy\",\"last_name\":\"Graham\",\"status\":\"active\",\"date_of_birth\":\"2008-11-28T00:00:00\",\"age\":\"13y 11m\",\"unit_council\":true,\"patrol_name\":\"Tassie Tigers\",\"patrol_duty\":\"APL\",\"patrol_order\":2,\"isAdultLeader\":0,\"selected\":false},{\"id\":\"ee791361-6a3c-3db5-b7ff-1301283fa803\",\"member_number\":\"1125790\",\"first_name\":\"Chloe\",\"last_name\":\"Small\",\"status\":\"active\",\"date_of_birth\":\"2011-05-05T00:00:00\",\"age\":\"11y 6m\",\"unit_council\":false,\"patrol_name\":\"Drop Bear\",\"patrol_duty\":\"\",\"patrol_order\":3,\"isAdultLeader\":0,\"selected\":false},{\"id\":\"876ed453-8e89-3e1c-a689-59aed29d6a7c\",\"member_number\":\"1159891\",\"first_name\":\"Daniel\",\"last_name\":\"Chung\",\"status\":\"active\",\"date_of_birth\":\"2008-10-01T00:00:00\",\"age\":\"14y 1m\",\"unit_council\":false,\"patrol_name\":\"Magpie\",\"patrol_duty\":\"\",\"patrol_order\":3,\"isAdultLeader\":0,\"selected\":false},{\"id\":\"8e9a6aba-f3e6-3ef2-beaf-5eed0688dd3b\",\"member_number\":\"1059670\",\"first_name\":\"Eric\",\"last_name\":\"Liu\",\"status\":\"active\",\"date_of_birth\":\"2008-07-22T00:00:00\",\"age\":\"14y 3m\",\"unit_council\":true,\"patrol_name\":\"Lyrebird\",\"patrol_duty\":\"PL\",\"patrol_order\":1,\"isAdultLeader\":0,\"selected\":false},{\"id\":\"31107ada-9841-3575-8429-8365235c0f42\",\"member_number\":\"1103159\",\"first_name\":\"Ethan\",\"last_name\":\"Lloyd\",\"status\":\"active\",\"date_of_birth\":\"2008-01-30T00:00:00\",\"age\":\"14y 9m\",\"unit_council\":false,\"patrol_name\":\"Drop Bear\",\"patrol_duty\":\"\",\"patrol_order\":3,\"isAdultLeader\":0,\"selected\":false},{\"id\":\"8d39e613-c1d4-3028-8302-5c32f0bc1e65\",\"member_number\":\"1157492\",\"first_name\":\"James\",\"last_name\":\"Alchin\",\"status\":\"active\",\"date_of_birth\":\"2009-09-15T00:00:00\",\"age\":\"13y 1m\",\"unit_council\":false,\"patrol_name\":\"Drop Bear\",\"patrol_duty\":\"\",\"patrol_order\":3,\"isAdultLeader\":0,\"selected\":false},{\"id\":\"6e7c548c-0f67-3061-96e9-7d2844cd972c\",\"member_number\":\"1044135\",\"first_name\":\"James\",\"last_name\":\"Li\",\"status\":\"active\",\"date_of_birth\":\"2009-09-26T00:00:00\",\"age\":\"13y 1m\",\"unit_council\":true,\"patrol_name\":\"Platypus\",\"patrol_duty\":\"APL\",\"patrol_order\":2,\"isAdultLeader\":0,\"selected\":false},{\"id\":\"a6857915-5bd0-3d96-9016-05e7e435dfce\",\"member_number\":\"1105152\",\"first_name\":\"Jeremy\",\"last_name\":\"Chim\",\"status\":\"active\",\"date_of_birth\":\"2011-04-26T00:00:00\",\"age\":\"11y 6m\",\"unit_council\":false,\"patrol_name\":\"Magpie\",\"patrol_duty\":\"\",\"patrol_order\":3,\"isAdultLeader\":0,\"selected\":false},{\"id\":\"5c1ad6a1-90db-346f-923f-964a02187b0a\",\"member_number\":\"1104233\",\"first_name\":\"Johnny\",\"last_name\":\"Li\",\"status\":\"active\",\"date_of_birth\":\"2009-12-03T00:00:00\",\"age\":\"12y 11m\",\"unit_council\":false,\"patrol_name\":\"Tassie Tigers\",\"patrol_duty\":\"\",\"patrol_order\":3,\"isAdultLeader\":0,\"selected\":false},{\"id\":\"5ad97f79-ff0a-3e2f-abe0-94d5e3515ac2\",\"member_number\":\"1102300\",\"first_name\":\"Jonathan\",\"last_name\":\"Li\",\"status\":\"active\",\"date_of_birth\":\"2009-12-16T00:00:00\",\"age\":\"12y 10m\",\"unit_council\":false,\"patrol_name\":\"Platypus\",\"patrol_duty\":\"\",\"patrol_order\":3,\"isAdultLeader\":0,\"selected\":false},{\"id\":\"cd1929ca-d2a7-3922-b643-2c7678527d77\",\"member_number\":\"1125788\",\"first_name\":\"Joshua\",\"last_name\":\"Jones\",\"status\":\"active\",\"date_of_birth\":\"2010-11-22T00:00:00\",\"age\":\"11y 11m\",\"unit_council\":false,\"patrol_name\":\"Platypus\",\"patrol_duty\":\"\",\"patrol_order\":3,\"isAdultLeader\":0,\"selected\":false},{\"id\":\"bdffb81e-6980-300c-afa0-539fd43831bf\",\"member_number\":\"1113946\",\"first_name\":\"Katrina\",\"last_name\":\"Koop\",\"status\":\"active\",\"date_of_birth\":\"2008-10-01T00:00:00\",\"age\":\"14y 1m\",\"unit_council\":true,\"patrol_name\":\"Scout Unit Council\",\"patrol_duty\":\"UL\",\"patrol_order\":0,\"isAdultLeader\":0,\"selected\":false},{\"id\":\"4fadd3a9-4c17-348a-87fd-9cfe93bbd898\",\"member_number\":\"1071573\",\"first_name\":\"Lukas\",\"last_name\":\"Dunn\",\"status\":\"active\",\"date_of_birth\":\"2010-10-19T00:00:00\",\"age\":\"12y 0m\",\"unit_council\":false,\"patrol_name\":\"Lyrebird\",\"patrol_duty\":\"\",\"patrol_order\":3,\"isAdultLeader\":0,\"selected\":false},{\"id\":\"9ff9237a-bc06-3c72-904d-562d2d48ab6c\",\"member_number\":\"1154517\",\"first_name\":\"Matthew\",\"last_name\":\"Last\",\"status\":\"active\",\"date_of_birth\":\"2011-05-30T00:00:00\",\"age\":\"11y 5m\",\"unit_council\":false,\"patrol_name\":\"Tassie Tigers\",\"patrol_duty\":\"\",\"patrol_order\":3,\"isAdultLeader\":0,\"selected\":false},{\"id\":\"e228a1b5-084e-3156-9666-aabff9ed0808\",\"member_number\":\"1159648\",\"first_name\":\"Peter\",\"last_name\":\"Xia\",\"status\":\"active\",\"date_of_birth\":\"2010-06-22T00:00:00\",\"age\":\"12y 4m\",\"unit_council\":false,\"patrol_name\":\"Lyrebird\",\"patrol_duty\":\"\",\"patrol_order\":3,\"isAdultLeader\":0,\"selected\":false},{\"id\":\"66c977e8-bf59-31a1-91d9-69459a0d199c\",\"member_number\":\"1071576\",\"first_name\":\"Phoenix\",\"last_name\":\"Cao\",\"status\":\"active\",\"date_of_birth\":\"2010-05-21T00:00:00\",\"age\":\"12y 5m\",\"unit_council\":false,\"patrol_name\":\"Platypus\",\"patrol_duty\":\"\",\"patrol_order\":3,\"isAdultLeader\":0,\"selected\":false},{\"id\":\"ede8d90f-2ec6-3a66-b2fa-794f8a6a318a\",\"member_number\":\"1154716\",\"first_name\":\"Ronit\",\"last_name\":\"Natarajan\",\"status\":\"active\",\"date_of_birth\":\"2011-06-07T00:00:00\",\"age\":\"11y 4m\",\"unit_council\":false,\"patrol_name\":\"Magpie\",\"patrol_duty\":\"\",\"patrol_order\":3,\"isAdultLeader\":0,\"selected\":false},{\"id\":\"7e3aeaf6-2248-35e9-8fbe-e7239300e3d4\",\"member_number\":\"1038582\",\"first_name\":\"Sebastien\",\"last_name\":\"Wookey\",\"status\":\"active\",\"date_of_birth\":\"2009-05-29T00:00:00\",\"age\":\"13y 5m\",\"unit_council\":true,\"patrol_name\":\"Lyrebird\",\"patrol_duty\":\"APL\",\"patrol_order\":2,\"isAdultLeader\":0,\"selected\":false},{\"id\":\"aac9e4d8-b68f-312f-a0a8-8f0e6cfb0c54\",\"member_number\":\"1059661\",\"first_name\":\"Tynn\",\"last_name\":\"Yam\",\"status\":\"active\",\"date_of_birth\":\"2010-01-10T00:00:00\",\"age\":\"12y 9m\",\"unit_council\":true,\"patrol_name\":\"Magpie\",\"patrol_duty\":\"PL\",\"patrol_order\":1,\"isAdultLeader\":0,\"selected\":false},{\"id\":\"5d122dd4-2b4a-36d3-b305-3a802c9cae99\",\"member_number\":\"1143210\",\"first_name\":\"Yang\",\"last_name\":\"Pan\",\"status\":\"active\",\"date_of_birth\":\"2008-08-02T00:00:00\",\"age\":\"14y 3m\",\"unit_council\":false,\"patrol_name\":\"Tassie Tigers\",\"patrol_duty\":\"\",\"patrol_order\":3,\"isAdultLeader\":0,\"selected\":false},{\"id\":\"90505b04-61f6-3892-81de-a76544a4e460\",\"member_number\":\"1102291\",\"first_name\":\"Zara\",\"last_name\":\"Williams\",\"status\":\"active\",\"date_of_birth\":\"2010-09-04T00:00:00\",\"age\":\"12y 2m\",\"unit_council\":true,\"patrol_name\":\"Drop Bear\",\"patrol_duty\":\"PL\",\"patrol_order\":1,\"isAdultLeader\":0,\"selected\":false},{\"id\":\"1f6ade3b-4280-3d68-b3ac-3decdcc5073d\",\"member_number\":\"1100542\",\"first_name\":\"Zoe\",\"last_name\":\"Lloyd\",\"status\":\"active\",\"date_of_birth\":\"2010-09-15T00:00:00\",\"age\":\"12y 1m\",\"unit_council\":false,\"patrol_name\":\"Lyrebird\",\"patrol_duty\":\"\",\"patrol_order\":3,\"isAdultLeader\":0,\"selected\":false},{\"id\":\"4d41f446-9963-3ffd-a677-1fd4eef84cb5\",\"member_number\":\"1102294\",\"first_name\":\"Zoe\",\"last_name\":\"Williams\",\"status\":\"active\",\"date_of_birth\":\"2010-09-04T00:00:00\",\"age\":\"12y 2m\",\"unit_council\":true,\"patrol_name\":\"Platypus\",\"patrol_duty\":\"PL\",\"patrol_order\":1,\"isAdultLeader\":0,\"selected\":false}]"
            };
            if (!Directory.Exists("TestResults"))
                Directory.CreateDirectory("TestResults");
        }

        [TestMethod]
        public void MemberList_ToPDF()
        {
            var proxyRequest = new Amazon.Lambda.APIGatewayEvents.APIGatewayProxyRequest();
            proxyRequest.Body = JsonConvert.SerializeObject(_reportGenerationRequest);
            var functionResult = _function.FunctionHandler(proxyRequest, null);
            //Convert Base64String into PDF document
            byte[] bytes = Convert.FromBase64String(functionResult);
            FileStream fileStream = new FileStream(@"TestResults\MemberList_ToPDF.pdf", FileMode.Create);
            BinaryWriter writer = new BinaryWriter(fileStream);
            writer.Write(bytes, 0, bytes.Length);
            writer.Close();
        }

    }
}
